import base.BaseTest;
import com.codeborne.selenide.Selenide;
import com.codeborne.selenide.WebDriverRunner;
import core.Props;
import core.pages.InboxPage;
import core.pages.LoginPage;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import ru.yandex.qatools.allure.annotations.Features;
import ru.yandex.qatools.allure.annotations.Stories;
import ru.yandex.qatools.allure.annotations.Title;

import java.util.Random;

/**
 * Created by Aleks on 26.06.2017.
 */
@Features("Яндекс почта")
@Stories("Основные действия")
@Title("Смок-тесты")
public class YaPostTest extends BaseTest {


    @Test
    @Title("Отправка письма")
    public void sendEmailTest() {
        String sendTo = "opentestuser@yandex.ru";
        String subj = "iamNewMail" + new Random(21344).nextInt();
        new LoginPage()
                .login()
                .openNewMailPage()
                .fillAndSendLetter(sendTo, subj)
                .assertMailIsSend();

    }

    @Test
    @Title("Удаление письма")
    public void deleteMail() {
        String subj = "Delete";
        new LoginPage()
                .login()
                .selectMail(subj)
                .deleteMails()
                .assertMailsIsDeleted(subj);


    }

    @Test
    @Title("Перемещение письма в Спам")
    public void moveMailToSpamFolder() {
        String subjToSpam = "Spam!";
        new LoginPage()
                .login()
                .selectMail(subjToSpam)
                .moveSelectedMailToSpam()
                .goToSpam()
                .assertMailWithSubjInSpam(subjToSpam);
    }

    @Test
    @Title("Поиск письма")
    public void searchMail() {
        String senderToSearch = "opentestuser";
        new LoginPage()
                .login()
                .searchMail(senderToSearch)
                .assertSearchResultIsFine(senderToSearch);

    }

    @Test
    @Title("Пометить письмо как Избранное")
    public void setAFavoriteFlag() {
        String mailToMark = "iam a favorite!";
        new LoginPage()
                .login()
                .selectMailAsFavorite(mailToMark)
                .assertMailIsFavorite(mailToMark);
    }


    @After
    public void clearBrowser() {
        new InboxPage().logout();
        WebDriverRunner.clearBrowserCache();
    }

    @Before
    public void login() {
        Selenide.open(Props.startUrl);
    }

}
